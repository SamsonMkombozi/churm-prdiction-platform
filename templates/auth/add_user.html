{% extends 'base.html' %}

{% block title %}Add User - {{ current_user.company.name }}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2">
            <i class="fas fa-user-plus me-2"></i>Add New User
        </h1>
        <a href="{{ url_for('company.users') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>Back to Users
        </a>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body p-4">
                    <form method="POST" action="{{ url_for('company.add_user') }}">
                        <!-- Email -->
                        <div class="mb-3">
                            <label for="email" class="form-label">Email Address *</label>
                            <input type="email" 
                                   class="form-control" 
                                   id="email" 
                                   name="email" 
                                   placeholder="user@example.com"
                                   required>
                            <small class="form-text text-muted">User will log in with this email</small>
                        </div>

                        <!-- Full Name -->
                        <div class="mb-3">
                            <label for="full_name" class="form-label">Full Name *</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="full_name" 
                                   name="full_name" 
                                   placeholder="John Doe"
                                   required>
                        </div>

                        <!-- Role -->
                        <div class="mb-3">
                            <label for="role" class="form-label">Role *</label>
                            <select class="form-select" id="role" name="role" required>
                                <option value="">Select a role</option>
                                <option value="viewer">Viewer - Can view data only</option>
                                <option value="analyst">Analyst - Can view and analyze data</option>
                                <option value="manager">Manager - Can manage users and settings</option>
                                <option value="admin">Admin - Full access</option>
                            </select>
                            <small class="form-text text-muted">
                                <strong>Viewer:</strong> Read-only access | 
                                <strong>Analyst:</strong> Can run predictions | 
                                <strong>Manager:</strong> Can manage users | 
                                <strong>Admin:</strong> Full control
                            </small>
                        </div>

                        <!-- Password -->
                        <div class="mb-3">
                            <label for="password" class="form-label">Password *</label>
                            <input type="password" 
                                   class="form-control" 
                                   id="password" 
                                   name="password" 
                                   placeholder="At least 6 characters"
                                   required
                                   minlength="6">
                            <small class="form-text text-muted">Minimum 6 characters</small>
                        </div>

                        <!-- Confirm Password -->
                        <div class="mb-4">
                            <label for="confirm_password" class="form-label">Confirm Password *</label>
                            <input type="password" 
                                   class="form-control" 
                                   id="confirm_password" 
                                   name="confirm_password" 
                                   placeholder="Re-enter password"
                                   required>
                        </div>

                        <!-- Active Status -->
                        <div class="mb-4">
                            <div class="form-check form-switch">
                                <input class="form-check-input" 
                                       type="checkbox" 
                                       id="is_active" 
                                       name="is_active" 
                                       checked>
                                <label class="form-check-label" for="is_active">
                                    Account Active
                                </label>
                                <small class="form-text text-muted d-block">
                                    Uncheck to create an inactive account
                                </small>
                            </div>
                        </div>

                        <!-- Buttons -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('company.users') }}" class="btn btn-outline-secondary">
                                Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-user-plus me-2"></i>Add User
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Help Section -->
            <div class="card mt-4">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>Role Permissions
                    </h6>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-3">Viewer</dt>
                        <dd class="col-sm-9">Can view dashboard, customers, and reports. Read-only access.</dd>
                        
                        <dt class="col-sm-3">Analyst</dt>
                        <dd class="col-sm-9">All Viewer permissions plus ability to run predictions and export data.</dd>
                        
                        <dt class="col-sm-3">Manager</dt>
                        <dd class="col-sm-9">All Analyst permissions plus ability to manage users and company settings.</dd>
                        
                        <dt class="col-sm-3 mb-0">Admin</dt>
                        <dd class="col-sm-9 mb-0">Full access to all features including billing and integrations.</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Password match validation
document.getElementById('confirm_password').addEventListener('input', function() {
    const password = document.getElementById('password').value;
    const confirm = this.value;
    
    if (confirm && password !== confirm) {
        this.setCustomValidity('Passwords do not match');
    } else {
        this.setCustomValidity('');
    }
});

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const password = document.getElementById('password').value;
    const confirm = document.getElementById('confirm_password').value;
    
    if (password !== confirm) {
        e.preventDefault();
        alert('Passwords do not match!');
        return false;
    }
    
    if (password.length < 6) {
        e.preventDefault();
        alert('Password must be at least 6 characters!');
        return false;
    }
});
</script>
{% endblock %}