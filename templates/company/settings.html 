{% extends 'base.html' %}

{% block title %}Company Settings - {{ company.name }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">
        <i class="fas fa-cog me-2"></i>Company Settings
    </h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{{ url_for('company.index') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>Back to Overview
        </a>
    </div>
</div>

<form method="POST" action="{{ url_for('company.settings') }}">
    <!-- Basic Information -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Basic Information</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="name" class="form-label">Company Name *</label>
                        <input type="text" class="form-control" id="name" name="name" value="{{ company.name }}" required>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="industry" class="form-label">Industry</label>
                        <input type="text" class="form-control" id="industry" name="industry" value="{{ company.industry or '' }}">
                    </div>
                </div>
            </div>
            
            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <textarea class="form-control" id="description" name="description" rows="3">{{ company.description or '' }}</textarea>
            </div>
            
            <div class="mb-3">
                <label for="website" class="form-label">Website</label>
                <input type="url" class="form-control" id="website" name="website" value="{{ company.website or '' }}" placeholder="https://example.com">
            </div>
        </div>
    </div>
    
    <!-- CRM Integration -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">CRM Integration</h5>
        </div>
        <div class="card-body">
            <div class="mb-3">
                <label for="crm_api_url" class="form-label">CRM API URL</label>
                <input type="url" class="form-control" id="crm_api_url" name="crm_api_url" value="{{ company.crm_api_url or '' }}" placeholder="https://your-crm.com/api">
                <small class="form-text text-muted">Habari CRM API endpoint URL</small>
            </div>
            
            <div class="mb-3">
                <label for="crm_api_key" class="form-label">CRM API Key</label>
                <input type="password" class="form-control" id="crm_api_key" name="crm_api_key" placeholder="Leave blank to keep current key">
                <small class="form-text text-muted">Your CRM API authentication key (stored encrypted)</small>
            </div>
            
            <div class="mb-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="enable_auto_sync" name="enable_auto_sync" {{ 'checked' if company.get_setting('enable_auto_sync', True) }}>
                    <label class="form-check-label" for="enable_auto_sync">
                        Enable Automatic Data Synchronization
                    </label>
                </div>
            </div>
            
            <div class="mb-3">
                <label for="sync_frequency" class="form-label">Sync Frequency (seconds)</label>
                <select class="form-select" id="sync_frequency" name="sync_frequency">
                    <option value="900" {{ 'selected' if company.get_setting('sync_frequency') == 900 }}>Every 15 minutes</option>
                    <option value="1800" {{ 'selected' if company.get_setting('sync_frequency') == 1800 }}>Every 30 minutes</option>
                    <option value="3600" {{ 'selected' if company.get_setting('sync_frequency', 3600) == 3600 }}>Every hour</option>
                    <option value="7200" {{ 'selected' if company.get_setting('sync_frequency') == 7200 }}>Every 2 hours</option>
                    <option value="21600" {{ 'selected' if company.get_setting('sync_frequency') == 21600 }}>Every 6 hours</option>
                    <option value="86400" {{ 'selected' if company.get_setting('sync_frequency') == 86400 }}>Daily</option>
                </select>
            </div>
        </div>
    </div>
    
    <!-- Notification Settings -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Notification Settings</h5>
        </div>
        <div class="card-body">
            <div class="mb-3">
                <label for="notification_email" class="form-label">Notification Email</label>
                <input type="email" class="form-control" id="notification_email" name="notification_email" value="{{ company.get_setting('notification_email', '') }}">
                <small class="form-text text-muted">Email address for system notifications</small>
            </div>
            
            <div class="mb-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="enable_email_alerts" name="enable_email_alerts" {{ 'checked' if company.get_setting('enable_email_alerts') }}>
                    <label class="form-check-label" for="enable_email_alerts">
                        Enable Email Alerts for High-Risk Customers
                    </label>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Prediction Settings -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Churn Prediction Settings</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="threshold_high" class="form-label">High Risk Threshold</label>
                        <input type="number" class="form-control" id="threshold_high" name="threshold_high" value="{{ company.get_setting('prediction_threshold_high', 0.7) }}" min="0" max="1" step="0.1">
                        <small class="form-text text-muted">Churn probability above this value = High Risk (default: 0.7)</small>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="mb-3">
                        <label for="threshold_medium" class="form-label">Medium Risk Threshold</label>
                        <input type="number" class="form-control" id="threshold_medium" name="threshold_medium" value="{{ company.get_setting('prediction_threshold_medium', 0.4) }}" min="0" max="1" step="0.1">
                        <small class="form-text text-muted">Churn probability above this value = Medium Risk (default: 0.4)</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Regional Settings -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">Regional Settings</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="timezone" class="form-label">Timezone</label>
                        <select class="form-select" id="timezone" name="timezone">
                            <option value="UTC" {{ 'selected' if company.get_setting('timezone', 'UTC') == 'UTC' }}>UTC</option>
                            <option value="Africa/Nairobi" {{ 'selected' if company.get_setting('timezone') == 'Africa/Nairobi' }}>Africa/Nairobi (EAT)</option>
                            <option value="America/New_York" {{ 'selected' if company.get_setting('timezone') == 'America/New_York' }}>America/New_York (EST)</option>
                            <option value="Europe/London" {{ 'selected' if company.get_setting('timezone') == 'Europe/London' }}>Europe/London (GMT)</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="date_format" class="form-label">Date Format</label>
                        <select class="form-select" id="date_format" name="date_format">
                            <option value="%Y-%m-%d" {{ 'selected' if company.get_setting('date_format', '%Y-%m-%d') == '%Y-%m-%d' }}>YYYY-MM-DD</option>
                            <option value="%d/%m/%Y" {{ 'selected' if company.get_setting('date_format') == '%d/%m/%Y' }}>DD/MM/YYYY</option>
                            <option value="%m/%d/%Y" {{ 'selected' if company.get_setting('date_format') == '%m/%d/%Y' }}>MM/DD/YYYY</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="currency" class="form-label">Currency</label>
                        <select class="form-select" id="currency" name="currency">
                            <option value="USD" {{ 'selected' if company.get_setting('currency', 'USD') == 'USD' }}>USD ($)</option>
                            <option value="KES" {{ 'selected' if company.get_setting('currency') == 'KES' }}>KES (KSh)</option>
                            <option value="EUR" {{ 'selected' if company.get_setting('currency') == 'EUR' }}>EUR (€)</option>
                            <option value="GBP" {{ 'selected' if company.get_setting('currency') == 'GBP' }}>GBP (£)</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Submit Button -->
    <div class="mb-4">
        <button type="submit" class="btn btn-primary btn-lg">
            <i class="fas fa-save me-2"></i>Save Settings
        </button>
        <a href="{{ url_for('company.index') }}" class="btn btn-outline-secondary btn-lg">
            Cancel
        </a>
    </div>
</form>

{% endblock %}
